# Sales Data Sources

**What sales data exists and where it comes from**

---

## Sales Data Sources

### 1. M5 Dataset (Historical Real Data)
- **Source:** M5 Forecasting Competition dataset (Kaggle)
- **Date Range:** 2015-01-29 to 2024-12-31
- **Import Script:** `download_m5_data.py`
- **Purpose:** Real historical sales patterns for forecasting
- **Status:** ✅ Imported once, then preserved

### 2. Synthetic CSV Data
- **Source:** CSV files (e.g., `synthetic_ecom_chronos2_demo.csv`)
- **Date Range:** Varies (typically 2024 backwards)
- **Import Script:** `import_csv_to_ts_demand_daily.py`
- **Purpose:** Test/demo data
- **Status:** ✅ Imported as needed

### 3. Generated Recent Data (from today backwards)
- **Source:** Generated by `generate_recent_sales_data.py` or `shift_dates_to_recent.py`
- **Date Range:** Today backwards (last 30-365 days)
- **Purpose:** Fill gap between historical data and today
- **Status:** ✅ Generated automatically by `setup_test_data.py`

---

## Current Data Flow

```
┌─────────────────────────────────────────┐
│  Initial Import (One-time)              │
│  ───────────────────────────            │
│  1. M5 Dataset (2015-2024)              │
│     OR                                   │
│  2. Synthetic CSV (2024 backwards)      │
└─────────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│  ts_demand_daily Table                  │
│  ────────────────────────               │
│  Contains:                               │
│  - Historical sales (M5 or synthetic)   │
│  - Dates may be old (2015-2024)         │
└─────────────────────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│  setup_test_data.py                     │
│  ─────────────────────                  │
│  1. Gets item_ids from ts_demand_daily  │
│  2. Creates products, locations, etc.    │
│  3. Shifts dates to recent              │
│  4. Populates historical stock          │
└─────────────────────────────────────────┘
```

---

## Reset Options Explained

### Option 1: Keep Sales Data (Recommended)

```bash
reset_test_data.py --keep-sales-data
```

**What happens:**
1. ✅ Deletes: products, locations, suppliers, stock, conditions
2. ✅ **Keeps:** `ts_demand_daily` (all sales data - M5, synthetic, recent)
3. ✅ Re-creates: All test data structures
4. ✅ Shifts dates: Makes all data recent (if needed)
5. ✅ Populates stock: Historical stock data

**Use when:** You want fresh test data but keep valuable M5/synthetic sales history

---

### Option 2: Delete Everything (Complete Reset)

```bash
reset_test_data.py  # No --keep-sales-data flag
```

**What happens:**
1. ✅ Deletes: **Everything** including `ts_demand_daily`
2. ⚠️ **You must re-import sales data** before running setup
3. Then run: `setup_test_data.py` (but it will fail without sales data!)

**Problem:** `setup_test_data.py` requires existing sales data to get item_ids!

**Solution:** Use `setup_demo_client.py` instead (handles full workflow)

---

## Recommended Workflow

### For Complete Reset (Delete Everything)

**Use `setup_demo_client.py` instead:**

```bash
# This script handles the complete workflow:
# 1. Creates client
# 2. Imports sales data (M5 or CSV)
# 3. Creates all test data
# 4. Shifts dates
# 5. Populates stock

uv run python backend/scripts/setup_demo_client.py \
    --client-name "Fresh Test Client" \
    --csv data/synthetic_data/synthetic_ecom_chronos2_demo.csv
```

**Or manually:**

```bash
# 1. Delete everything
uv run python backend/scripts/reset_test_data.py --client-id <uuid>

# 2. Re-import sales data
uv run python backend/scripts/import_csv_to_ts_demand_daily.py \
    --csv data/synthetic_data/synthetic_ecom_chronos2_demo.csv \
    --client-id <uuid>

# 3. Create test data
uv run python backend/scripts/setup_test_data.py --client-id <uuid>
```

---

## What Sales Data Gets Kept?

### With `--keep-sales-data` Flag:

| Data Type | Source | Kept? | Reason |
|-----------|--------|-------|--------|
| **M5 Dataset** | Kaggle import | ✅ **Yes** | Valuable historical patterns |
| **Synthetic CSV** | CSV import | ✅ **Yes** | Test data |
| **Recent Generated** | `generate_recent_sales_data.py` | ✅ **Yes** | Recent data from today backwards |
| **Date-Shifted Data** | `shift_dates_to_recent.py` | ✅ **Yes** | All data preserved, dates updated |

**All sales data in `ts_demand_daily` is preserved!**

### Without `--keep-sales-data` Flag:

| Data Type | Kept? | What Happens |
|-----------|-------|--------------|
| **All Sales Data** | ❌ **No** | **Deleted** - Must re-import |

---

## Data Lifecycle

### Initial Setup (First Time)

```
1. Import M5 or CSV → ts_demand_daily populated
2. Run setup_test_data.py → Creates products, stock, etc.
3. Dates shifted to recent
4. Historical stock populated
```

### Reset (Keep Sales Data)

```
1. reset_test_data.py --keep-sales-data
   → Deletes: products, locations, suppliers, stock
   → Keeps: ts_demand_daily (all sales data)
2. setup_test_data.py (auto-called)
   → Re-creates everything
   → Uses existing sales data
```

### Complete Reset (Delete Everything)

```
1. reset_test_data.py (no flag)
   → Deletes: EVERYTHING including ts_demand_daily
2. Re-import sales data (M5 or CSV)
3. setup_test_data.py
   → Creates everything fresh
```

---

## Summary

**What sales data exists:**
- ✅ M5 dataset (2015-2024) - if imported
- ✅ Synthetic CSV data - if imported  
- ✅ Generated recent data - created by setup scripts

**What gets kept with `--keep-sales-data`:**
- ✅ **ALL sales data** in `ts_demand_daily` table
- ✅ M5, synthetic, recent - everything preserved

**What gets deleted without `--keep-sales-data`:**
- ❌ **ALL sales data** deleted
- ⚠️ Must re-import before running setup

**Recommendation:**
- Use `--keep-sales-data` to preserve valuable M5/synthetic data
- Only delete everything if you want a completely fresh start

---

**Status:** ✅ **CLARIFIED** - Sales data sources and reset options explained!
